<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KIMA ASWAN - Main Page</title>
    <link rel="stylesheet" href="../static/CSS/components/header.css">
    <link rel="stylesheet" href="../static/CSS/components/sidebar.css">
    <link rel="stylesheet" href="../static/CSS/components/footer.css">
    <link rel="stylesheet" href="EmptyMainPage.css">
</head>
<body>

<header class="header">
    <!-- Sidebar Toggle Button -->
    <button id="sidebarToggle" class="sidebar-toggle">
        <img src="../static/assets/menu-bar.png" style="width: 24px; height: 24px;">
    </button>
    <div class="search-container">
        <span class="search-icon"><img src="https://i.postimg.cc/6pMgv9SK/search-svgrepo-com.png" alt="Search Icon" style="width:20px; height:20px;"></span>
        <input type="text" class="search-box" placeholder="Search">
        <span class="mic-icon"><img src="https://i.postimg.cc/W4rmP80k/microphone-svgrepo-com.png" alt="Microphone Icon" style="width:20px; height:20px;"></span>
    </div>
    <div class="header-right">
        <a class="header-link" onclick="window.location.href='/'">Home</a>
        <button class="icon-btn"><img src="https://i.postimg.cc/5tqH3Rw7/bell-alt-svgrepo-com.png" alt="Notification Bell" style="width:20px; height:20px;"></button>
        <!-- Include profile dropdown component from static/utilities/Profile_DropDown/profile-dropdown.html -->
        <div class="profile-dropdown-wrapper">
            <button class="icon-btn profile-icon-btn" id="profileIconBtn" type="button">
                <img src="https://i.postimg.cc/YSp2pqW5/profile-round-1342-svgrepo-com.png" alt="Profile" style="width:20px; height:20px;">
            </button>
            <div class="profile-dropdown" id="profileDropdown">
                <div class="user-info">
                    <div class="user-icon">üë§</div>
                    <div class="user-details">
                        <div class="username">Username</div>
                        <div class="email">user.mail@gmail.com</div>
                    </div>
                </div>
                <hr class="separator">
                <button class="dropdown-item setting" onclick="openSettings()">
                    <div class="setting-icon">‚öôÔ∏è</div>
                    <span>Setting</span>
                </button>
                <button class="dropdown-item logout" onclick="logout()">
                    <div class="logout-icon">‚ñ∂</div>
                    <span>Log out</span>
                </button>
            </div>
        </div>
    </div>
</header>

<script src="../static/JS/components/profile-dropdown.js"></script>

<div id="sidebarOverlay" class="sidebar-overlay"></div>

<aside id="sidebar" class="sidebar closed">
    <div class="logo">
        <div class="logo-icon">‚ò•</div>
        <div class="logo-text">KIMA ASWAN</div>
    </div>

    <ul class="nav-menu">
        <li class="nav-item" onclick="window.location.href='/'">Dashboard</li>
        <li class="nav-item" onclick="window.location.href='/employees'">Employees</li>
        <li class="nav-item" onclick="window.location.href='/suppliers'">Suppliers</li>
        <li class="nav-item" onclick="window.location.href='/products'">Products</li>
        <li class="nav-item" onclick="window.location.href='/customers'">Customers</li>
    </ul>

    <div class="help-section">
        <div class="help-title">Need help?</div>
        <div class="help-link">Open our help center</div>
    </div>
</aside>

<script src="../static/JS/components/sidebar.js"></script>

<!-- Main Content Area -->

<div class="card-container">
    <div class="action-buttons">
        <button class="action-btn" onclick="deleteTransport()" title="Delete" aria-label="Delete transportation record">
            <img src="../static/assets/delete.png" alt="Delete" style="width:30px; height:30px;">
        </button>
        <button class="action-btn hidden" id="save-btn" onclick="saveTransport()" title="Save Changes" aria-label="Save changes to transportation record">
            <img src="../static/assets/diskette.png" alt="save" style="width:30px; height:30px;">
        </button>
        <button class="action-btn" id="edit-btn" onclick="toggleEditMode()" title="Edit" aria-label="Edit transportation record">
            <img src="../static/assets/edit.png" alt="Edit" style="width:30px; height:30px;">
        </button>
    </div>

    <div class="card">
        <div class="card-header">
            <div class="card-avatar">
                <img src="../../static/assets/user.png" alt="user avatar">
            </div>
            <div class="card-info">
                <div class="info-row">
                    <span class="info-label">Name:</span>
                    <div class="detail-content">
                        <span class="detail-text" data-field="name">Test</span>
                        <input type="text" class="detail-value detail-input hidden" id="name" name="name" value="Test">
                    </div>
                </div>
                <div class="info-row">
                    <span class="info-label">ID:</span>
                    <div class="detail-content">
                        <span class="detail-text" data-field="id">12345</span>
                        <input type="text" class="detail-value detail-input hidden" id="id" name="id" value="12345">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="transport-details-card">
        <div class="details-list" id="transport-details-form">
            <div class="detail-item">
                <label class="detail-label" for="category">Address:</label>
                <div class="detail-content">
                    <span class="detail-text" data-field="category">Chemicals</span>
                    <input type="text" class="detail-value detail-input hidden" id="category" name="category" value="Chemicals">
                </div>
            </div>
            <div class="detail-item">
                <label class="detail-label" for="category">Phone:</label>
                <div class="detail-content">
                    <span class="detail-text" data-field="category">Chemicals</span>
                    <input type="text" class="detail-value detail-input hidden" id="category" name="category" value="Chemicals">
                </div>
            </div>
            <div class="detail-item">
                <label class="detail-label" for="productionDate">Status:</label>
                <div class="detail-content">
                    <span class="detail-text" data-field="productionDate">2025-01-15</span>
                    <input type="text" class="detail-value detail-input hidden" id="productionDate" name="productionDate" value="2025-01-15">
                </div>
            </div>

            <div class="detail-item">
                <label class="detail-label" for="expiryDuration">Phone:</label>
                <div class="detail-content">
                    <span class="detail-text" data-field="expiryDuration">12 months</span>
                    <input type="text" class="detail-value detail-input hidden" id="expiryDuration" name="expiryDuration" value="12 months">
                </div>
            </div>

            <div class="detail-item">
                <label class="detail-label" for="costPrice">Rating:</label>
                <div class="detail-content">
                    <span class="detail-text" data-field="costPrice">50.00</span>
                    <input type="text" class="detail-value detail-input hidden" id="costPrice" name="costPrice" value="50.00">
                </div>
            </div>

            <div class="detail-item">
                <label class="detail-label" for="weight">Email:</label>
                <div class="detail-content">
                    <span class="detail-text" data-field="weight">20 kg</span>
                    <input type="text" class="detail-value detail-input hidden" id="weight" name="weight" value="20 kg">
                </div>
            </div>

        </div>
    </div>
</div>



<footer class="footer">
    <div class="footer-content">
        <p class="footer-text">¬© 2024 KIMA ASWAN Factory Chemical Management System</p>
        <p class="footer-text">Designed for efficient chemical material inventory management</p>
        <div class="footer-links">
            <a href="#" class="footer-link" data-route="privacy_policy">Privacy Policy</a>
            <a href="#" class="footer-link" data-route="terms_of_service">Terms of Service</a>
            <a href="#" class="footer-link" data-route="contact_support">Contact Support</a>
            <a href="#" class="footer-link" data-route="documentation">Documentation</a>
        </div>
    </div>
</footer>

<script>
// Variable to track the current mode
let isEditing = false;
const transportIdElement = document.querySelector('.transport-id');
// Assuming the transport ID is stored in a data attribute
const transportId = transportIdElement.getAttribute('data-transport-id');

/**
 * Toggles the card between view and edit modes.
 */
function toggleEditMode() {
    isEditing = !isEditing;

    const detailTexts = document.querySelectorAll('.detail-text');
    const detailInputs = document.querySelectorAll('.detail-input');
    const editBtn = document.getElementById('edit-btn');
    const saveBtn = document.getElementById('save-btn');

    if (isEditing) {
        // --- ENTER EDIT MODE ---
        editBtn.classList.add('hidden'); // Hide Edit
        saveBtn.classList.remove('hidden'); // Show Save

        detailTexts.forEach(text => {
            text.classList.add('hidden'); // Hide display text
        });

        detailInputs.forEach(input => {
            // Update input value with the current display text value
            const currentValue = input.parentNode.querySelector('.detail-text').textContent;
            input.value = currentValue.trim();
            input.classList.remove('hidden'); // Show input field
        });

    } else {
        // --- ENTER VIEW MODE (or cancel editing without saving) ---
        editBtn.classList.remove('hidden'); // Show Edit
        saveBtn.classList.add('hidden'); // Hide Save

        detailTexts.forEach(text => {
            text.classList.remove('hidden'); // Show display text
        });

        detailInputs.forEach(input => {
            input.classList.add('hidden'); // Hide input field
        });
    }
}

/**
 * Collects data from input fields and sends it to the Flask backend.
 */
async function saveTransport() {
    const formData = {};
    const detailInputs = document.querySelectorAll('.detail-input');
    
    // 1. Collect data from input fields
    detailInputs.forEach(input => {
        // Use the 'name' attribute as the key for the data
        formData[input.name] = input.value;
    });

    console.log('Data to be sent:', formData);

    try {
        // 2. Send data using the Fetch API (AJAX)
        const response = await fetch(`/api/transport/${transportId}`, { // <-- YOUR FLASK ENDPOINT HERE
            method: 'PUT', // Use PUT or POST for updates
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData),
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const result = await response.json();
        
        // 3. Update the displayed text with the saved data
        // (Use the data returned from the server for accuracy)
        detailInputs.forEach(input => {
             // Find the corresponding display element and update its content
            const detailText = input.parentNode.querySelector('.detail-text');
            // Use the value from the input field for immediate visual update
            detailText.textContent = input.value; 
        });

        // 4. Switch back to view mode
        toggleEditMode(); 
        alert('Transportation record updated successfully!');

    } catch (error) {
        console.error('Error saving transportation record:', error);
        alert('Failed to save changes. Check console for details.');
        // Optionally, don't switch back to view mode on error
    }
}

/**
 * Handles the delete action (as you had before)
 */
function deleteTransport() {
    if (confirm('Are you sure you want to delete this transportation record?')) {
        console.log('Delete action triggered for ID:', transportId);
        // Add your AJAX delete logic here
    }
}
</script>

</body>
</html>